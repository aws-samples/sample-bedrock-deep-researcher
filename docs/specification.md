# Bedrock Deep Research - 技術仕様書

本ドキュメントでは、Bedrock Deep Researchプロジェクトの技術選定、コード規約、および技術的制約について詳細に記述します。

## 1. 技術選定

### 1.1 プログラミング言語
- **Python 3.12**: 最新の機能と改善されたパフォーマンスを活用するため、Python 3.12を採用しています。

### 1.2 フロントエンド
- **Streamlit**: データサイエンスとAIアプリケーション向けの高速なWebアプリケーションフレームワークとして選定。少ないコードで対話的なUIを構築できる利点があります。

### 1.3 AIモデルとサービス
- **Amazon Bedrock**: プロダクション環境でのAIモデルへのアクセスとデプロイを簡素化するフルマネージドサービス。
- **サポートされているモデル**:
  - Anthropic Claude 3.5 Haiku
  - Anthropic Claude 3.5 Sonnet v2
  - Anthropic Claude 3.7 Sonnet

### 1.4 ワークフローオーケストレーション
- **LangGraph**: 複雑なAIワークフローの管理と実行のためのフレームワーク。異なるステップ間の状態の流れを処理します。
- **LangChain AWS**: AWSサービス、特にBedrockとのLLM統合を容易にします。

### 1.5 外部API統合
- **Tavily API**: ウェブ検索と情報取得機能を提供。記事セクションに関連する情報を収集するために使用されます。

### 1.6 依存関係管理
- **Poetry**: パッケージ管理と仮想環境のために選定。依存関係の厳密なロックとプロジェクト設定の簡素化を実現します。

### 1.7 画像生成
- **Amazon Bedrock Nova Canvas**: 記事のヘッダー画像の生成に利用。

## 2. コード規約

### 2.1 コードスタイル
- **PEP 8**: Pythonコードスタイルガイドに準拠
- **Black**: コードフォーマッティングの自動化
- **pre-commit**: 変更をコミットする前に自動的なスタイルチェックを実行

### 2.2 型ヒント
- すべての関数とメソッドには**型ヒント**を含める
- Pydanticモデルを使用してデータ構造を型付け

### 2.3 モジュール構造
- 関心事の分離原則に従う
- 各ノードは単一責任の原則を遵守
- 継承よりもコンポジションを優先

### 2.4 例外処理
- 適切な例外処理を実装し、ユーザーフレンドリーなエラーメッセージを提供
- エラーのログ記録とユーザーへの通知を区別

### 2.5 ドキュメンテーション
- クラス、メソッド、関数には適切なドキュメント文字列を含める
- 複雑なロジックには説明的なコメントを追加

### 2.6 命名規則
- **クラス**: UpperCamelCase（例: `BedrockDeepResearch`）
- **関数・メソッド**: snake_case（例: `get_state`）
- **変数**: snake_case（例: `article_id`）
- **定数**: UPPER_CASE（例: `DEFAULT_TOPIC`）

## 3. 技術制約

### 3.1 サポートされるプラットフォーム
- **ローカル開発環境**
- **Amazon SageMaker**:
  - JupyterLab
  - Code Editor

### 3.2 AWS依存関係
- **地域制約**: 現在の設定では `us-east-1` リージョンに依存
- AWS認証が環境変数または設定で適切に構成されている必要がある

### 3.3 APIキー要件
- Tavily API: ウェブ検索機能を有効にするには有効なAPIキーが必要

### 3.4 モデルアクセス
- AWSコンソールで事前に特定のBedrockモデルへのアクセス権が付与されている必要がある

### 3.5 リソース要件
- **最小メモリ**: 8GB RAM推奨
- **ストレージ**: 基本の環境とパッケージに500MB以上
- **Python**: 3.12のみサポート

### 3.6 パフォーマンス制約
- ウェブ検索の待機時間はTavily APIに依存
- 記事生成プロセスは通常、記事の複雑さに応じて1〜5分かかる
- 画像生成には追加の時間が必要

### 3.7 セキュリティ
- APIキーやAWS認証情報は`.env`ファイルに保存し、バージョン管理から除外する必要がある
- `.env.tmp`をテンプレートとして使用し、実際の値は`.env`に保存

### 3.8 スケーラビリティ
- 現在の実装は同時ユーザー処理のためにスケールするようには設計されていない
- 大量の記事生成には、それに応じたクォータとリソース割り当ての調整が必要

## 4. デプロイ要件

### 4.1 必要な環境変数
- `TAVILY_API_KEY`: Tavily検索APIのアクセスキー
- `LOG_LEVEL`: オプション、デバッグモードを有効にする場合は`DEBUG`に設定

### 4.2 AWS設定
- AWS CLI認証が設定されていること
- Bedrockサービスへのアクセス権を持つIAMロールが設定されていること
- 選択したモデルへのアクセスが有効化されていること

### 4.3 パッケージ依存関係
- Poetryを使用してすべての依存関係をインストール（`poetry install`）
- 仮想環境を有効化（`poetry shell`）

## 5. パフォーマンス最適化

### 5.1 検索深度の調整
- `number_of_queries`と`max_search_depth`パラメータを調整することで、検索品質とパフォーマンスのバランスを取ることができる

### 5.2 モデル選択
- 記事計画は複雑さが高いため、より高性能な`Claude 3.7 Sonnet`をデフォルトで使用
- セクション執筆には高速な`Claude 3.5 Haiku`をデフォルトで使用し、バランスを取る

このような技術選定と規約により、Bedrock Deep Researchは拡張性が高く保守しやすいアプリケーションとして構築されています。AIモデルとワークフローオーケストレーションの最新の進展を活用しながら、ユーザーにシームレスな体験を提供します。 